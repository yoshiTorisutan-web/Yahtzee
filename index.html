<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Yams</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>üé≤</text></svg>"
    />

    <style>
      .de {
        transition: transform 0.2s;
      }
      .de:hover {
        transform: translateY(-5px) scale(1.1);
        cursor: pointer;
      }
      .de-garde {
        color: white;
        font-weight: bold;
      }
      .jouable {
        background-color: #d1fae5 !important;
        font-weight: bold;
      }
      .max-score {
        background-color: #34d399 !important; /* vert lumineux */
        font-weight: bold;
        color: white;
      }
      .zero-score {
        background-color: #fca5a5 !important; /* rouge clair */
        font-weight: bold;
        color: white;
      }
    </style>
  </head>

  <body
    class="bg-gradient-to-br from-indigo-300 to-indigo-600 flex items-center justify-center py-10"
  >
    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-4xl mx-4">
      <h1 class="text-4xl text-center font-extrabold mb-12 text-indigo-700">
        üé≤ Yams Intelligent
      </h1>

      <!-- Badge joueur actif + lancers -->
      <div class="flex flex-col items-center mb-6">
        <div
          id="badge-joueur-actif"
          class="flex items-center justify-center gap-3 mb-4"
        >
          <span class="text-2xl">üü£</span>
          <span class="text-2xl">üßë‚Äçüíº</span>
          <p class="text-xl font-semibold text-indigo-700">Tour du Joueur 1</p>
        </div>
        <p id="lancers" class="text-lg">Lancers restants : 3</p>
      </div>

      <!-- D√©s + bouton -->
      <div
        class="flex flex-col md:flex-row items-center justify-center mb-8 gap-6"
      >
        <div id="des" class="flex gap-4"></div>
        <button
          id="relancer"
          class="px-6 py-3 bg-blue-500 text-white rounded-xl shadow-md hover:bg-blue-600 transition"
        >
          Lancer
        </button>
      </div>

      <!-- Tableau des scores -->
      <div class="overflow-x-auto mb-12">
        <table
          class="w-full table-auto border-collapse text-center shadow-lg rounded-lg overflow-hidden"
        >
          <thead>
            <tr class="bg-gray-200 text-gray-800 uppercase">
              <th class="p-3 border">Cat√©gorie</th>
              <th class="p-3 border bg-indigo-100">üü£ Joueur 1</th>
              <th class="p-3 border bg-amber-100">üü† Joueur 2</th>
            </tr>
          </thead>
          <tbody id="scoreboard"></tbody>
        </table>
      </div>

      <p
        id="resultat"
        class="mt-6 text-xl font-bold text-purple-700 text-center"
      ></p>
      <!-- Bouton r√®gles du jeu -->
      <div class="flex justify-center mb-4">
        <button
          id="btn-regles"
          class="px-6 py-3 bg-green-500 text-white rounded-xl shadow-md hover:bg-green-600 transition"
        >
          üìñ R√®gles du jeu
        </button>
      </div>
    </div>

    <!-- Popup R√®gles du jeu -->
    <div
      id="popup-regles"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div
        class="bg-white rounded-3xl p-10 max-w-3xl w-full text-left shadow-2xl overflow-y-auto max-h-[90vh]"
      >
        <h2 class="text-3xl font-bold mb-12 text-purple-700 text-center">
          üìñ R√®gles du Yams
        </h2>
        <div class="mb-6 space-y-3">
          <p>
            Le <strong>Yams</strong> est un jeu de d√©s pour 2 joueurs. Chaque
            joueur lance <strong>5 d√©s</strong> par tour et peut relancer
            jusqu‚Äô√† 3 fois pour am√©liorer sa combinaison.
          </p>
          <p>
            Le but est de remplir le <strong>tableau de score</strong> avec les
            meilleures combinaisons possibles.
          </p>

          <p><strong>Cat√©gories et points :</strong></p>
          <ul class="list-disc list-inside">
            <li>
              <strong>As (1) √† Six (6) :</strong> Total des d√©s correspondants.
              Exemple : si tu as trois d√©s ‚Äú2‚Äù, tu peux mettre 6 points dans la
              case Deux (2).
            </li>
            <li>
              <strong>Brelan :</strong> Au moins 3 d√©s identiques ‚Üí somme de
              tous les d√©s. Exemple : 2-2-2-4-5 = 15 points.
            </li>
            <li>
              <strong>Carr√© :</strong> Au moins 4 d√©s identiques ‚Üí somme de tous
              les d√©s. Exemple : 5-5-5-5-2 = 22 points.
            </li>
            <li>
              <strong>Full :</strong> 3 d√©s identiques + 2 d√©s identiques ‚Üí 25
              points. Exemple : 3-3-3-6-6.
            </li>
            <li>
              <strong>Petite suite :</strong> 4 d√©s cons√©cutifs ‚Üí 30 points.
              Exemple : 1-2-3-4-x.
            </li>
            <li>
              <strong>Grande suite :</strong> 5 d√©s cons√©cutifs ‚Üí 40 points.
              Exemple : 2-3-4-5-6.
            </li>
            <li>
              <strong>Yams :</strong> 5 d√©s identiques ‚Üí 50 points. Exemple :
              6-6-6-6-6.
            </li>
            <li>
              <strong>Chance :</strong> Somme de tous les d√©s. Exemple :
              1-3-4-5-6 = 19 points.
            </li>
          </ul>

          <p>
            <strong>Bonus :</strong> Si le total des cases 1 √† 6 atteint au
            moins 63 points ‚Üí +35 points.
          </p>

          <p>
            <strong>Exemple de strat√©gie :</strong> Si tu as 3 d√©s ‚Äú2‚Äù et que tu
            n‚Äôas pas encore rempli la case Deux (2), tu peux choisir de la
            remplir pour 6 points, ou utiliser ce lancer pour une autre
            combinaison comme Brelan ou Chance selon ta main.
          </p>

          <p>
            Le joueur avec le <strong>total le plus √©lev√©</strong> √† la fin
            gagne la partie.
          </p>
        </div>

        <div class="flex justify-center gap-6 mt-12">
          <button
            id="popup-regles-close"
            class="px-6 py-3 bg-gray-400 text-white rounded-xl hover:bg-gray-500 transition"
          >
            Fermer
          </button>
        </div>
      </div>
    </div>

    <!-- Popup de victoire -->
    <div
      id="popup-victoire"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div
        class="bg-white rounded-3xl p-10 max-w-2xl w-full text-center shadow-2xl"
      >
        <h2
          id="popup-message"
          class="text-3xl font-bold mb-6 text-purple-700 truncate"
        ></h2>
        <div class="flex justify-center gap-6">
          <button
            id="popup-close"
            class="px-6 py-3 bg-gray-400 text-white rounded-xl hover:bg-gray-500 transition"
          >
            Fermer
          </button>
          <button
            id="popup-restart"
            class="px-6 py-3 bg-indigo-500 text-white rounded-xl hover:bg-indigo-600 transition"
          >
            Recommencer
          </button>
        </div>
      </div>
    </div>

    <script>
      const categories = [
        "As (1)",
        "Deux (2)",
        "Trois (3)",
        "Quatre (4)",
        "Cinq (5)",
        "Six (6)",
        "Brelan",
        "Carr√©",
        "Full",
        "Petite suite",
        "Grande suite",
        "Yams",
        "Chance",
      ];
      let des = [0, 0, 0, 0, 0];
      let gardes = [false, false, false, false, false];
      let lancersRestants = 3;
      let joueurActuel = 0;
      let scores = [
        Array(categories.length).fill(null),
        Array(categories.length).fill(null),
      ];

      const desContainer = document.getElementById("des");
      const relancerBtn = document.getElementById("relancer");
      const lancersText = document.getElementById("lancers");
      const badgeJoueur = document.getElementById("badge-joueur-actif");
      const scoreboard = document.getElementById("scoreboard");
      const resultat = document.getElementById("resultat");

      function initScoreboard() {
        scoreboard.innerHTML = "";

        categories.forEach((cat, i) => {
          let row = document.createElement("tr");
          row.innerHTML = `
      <td class="border p-2">${cat}</td>
      <td class="border p-2 cursor-pointer hover:bg-gray-100" id="score-0-${i}"></td>
      <td class="border p-2 cursor-pointer hover:bg-gray-100" id="score-1-${i}"></td>
    `;
          scoreboard.appendChild(row);

          document.getElementById(`score-0-${i}`).onclick = () =>
            choisirScore(0, i);
          document.getElementById(`score-1-${i}`).onclick = () =>
            choisirScore(1, i);

          // Ajouter Bonus juste apr√®s la sixi√®me cat√©gorie (index 5)
          if (i === 5) {
            let bonusRow = document.createElement("tr");
            bonusRow.innerHTML = `
        <td class="border p-2 font-bold bg-gray-100">Bonus => 63 pts</td>
        <td class="border p-2 font-bold" id="bonus-0">0</td>
        <td class="border p-2 font-bold" id="bonus-1">0</td>
      `;
            scoreboard.appendChild(bonusRow);
          }
        });

        // Ligne Total √† la fin
        let totalRow = document.createElement("tr");
        totalRow.innerHTML = `
    <td class="border p-2 font-bold bg-gray-100">Total</td>
    <td class="border p-2 font-bold" id="total-0">0</td>
    <td class="border p-2 font-bold" id="total-1">0</td>
  `;
        scoreboard.appendChild(totalRow);
      }

      function calculerBonus(joueur) {
        let somme = scores[joueur]
          .slice(0, 6)
          .reduce((a, b) => a + (b || 0), 0);
        return somme >= 63 ? 35 : 0;
      }

      function updateTotals() {
        const bonus0 = calculerBonus(0);
        const bonus1 = calculerBonus(1);
        document.getElementById("bonus-0").textContent = bonus0;
        document.getElementById("bonus-1").textContent = bonus1;
        document.getElementById("total-0").textContent =
          scores[0].reduce((a, b) => a + (b || 0), 0) + bonus0;
        document.getElementById("total-1").textContent =
          scores[1].reduce((a, b) => a + (b || 0), 0) + bonus1;
      }

      function lancerDes() {
        if (lancersRestants > 0) {
          for (let i = 0; i < 5; i++) {
            if (!gardes[i]) des[i] = Math.floor(Math.random() * 6) + 1;
          }
          lancersRestants--;
          majAffichage();
        }
      }

      function majAffichage() {
        desContainer.innerHTML = "";
        des.forEach((val, i) => {
          let de = document.createElement("div");
          de.textContent = val ? "üé≤" + val : "üé≤";
          de.className = `de w-16 h-16 md:w-20 md:h-20 flex items-center justify-center text-2xl md:text-3xl font-bold rounded-xl border shadow-md ${
            gardes[i]
              ? joueurActuel === 0
                ? "bg-indigo-400 border-indigo-600"
                : "bg-amber-400 border-amber-600"
              : "bg-gray-100 border-gray-400"
          }`;
          de.onclick = () => {
            gardes[i] = !gardes[i];
            majAffichage();
          };
          desContainer.appendChild(de);
        });
        lancersText.textContent = "Lancers restants : " + lancersRestants;

        // Badge joueur actif
        if (joueurActuel === 0) {
          badgeJoueur.innerHTML = `<span class="text-2xl">üü£</span><span class="text-2xl">üßë‚Äçüíº</span><p class="text-xl font-semibold text-indigo-700">Tour du Joueur 1</p>`;
        } else {
          badgeJoueur.innerHTML = `<span class="text-2xl">üü†</span><span class="text-2xl">üë©‚Äçüíº</span><p class="text-xl font-semibold text-amber-700">Tour du Joueur 2</p>`;
        }

        highlightChoices();
      }

      function calculerScore(catIndex) {
        switch (catIndex) {
          case 0:
            return des.filter((d) => d === 1).reduce((a, b) => a + b, 0);
          case 1:
            return des.filter((d) => d === 2).reduce((a, b) => a + b, 0);
          case 2:
            return des.filter((d) => d === 3).reduce((a, b) => a + b, 0);
          case 3:
            return des.filter((d) => d === 4).reduce((a, b) => a + b, 0);
          case 4:
            return des.filter((d) => d === 5).reduce((a, b) => a + b, 0);
          case 5:
            return des.filter((d) => d === 6).reduce((a, b) => a + b, 0);
          case 6:
            return estBrelan() ? sommeDes() : 0;
          case 7:
            return estCarre() ? sommeDes() : 0;
          case 8:
            return estFull() ? 25 : 0;
          case 9:
            return estPetiteSuite() ? 30 : 0;
          case 10:
            return estGrandeSuite() ? 40 : 0;
          case 11:
            return estYams() ? 50 : 0;
          case 12:
            return sommeDes();
          default:
            return 0;
        }
      }

      function sommeDes() {
        return des.reduce((a, b) => a + b, 0);
      }
      function estBrelan() {
        return des.some((v) => des.filter((x) => x === v).length >= 3);
      }
      function estCarre() {
        return des.some((v) => des.filter((x) => x === v).length >= 4);
      }
      function estFull() {
        let c = {};
        des.forEach((d) => (c[d] = (c[d] || 0) + 1));
        return Object.values(c).includes(3) && Object.values(c).includes(2);
      }
      function estPetiteSuite() {
        let d = [...new Set(des)].sort();
        return (
          d.join("").includes("1234") ||
          d.join("").includes("2345") ||
          d.join("").includes("3456")
        );
      }
      function estGrandeSuite() {
        let d = [...new Set(des)].sort();
        return d.join("").includes("12345") || d.join("").includes("23456");
      }
      function estYams() {
        return des.every((d) => d === des[0]);
      }

      function highlightChoices() {
        if (lancersRestants === 3) {
          categories.forEach((_, i) => {
            document
              .getElementById(`score-0-${i}`)
              .classList.remove("jouable", "max-score", "zero-score");
            document
              .getElementById(`score-1-${i}`)
              .classList.remove("jouable", "max-score", "zero-score");
          });
          return;
        }

        // Calcul du score maximum pour ce lancer
        let maxScore = 0;
        categories.forEach((_, i) => {
          if (scores[joueurActuel][i] === null) {
            let s = calculerScore(i);
            if (s > maxScore) maxScore = s;
          }
        });

        categories.forEach((_, i) => {
          const cellActive = document.getElementById(
            `score-${joueurActuel}-${i}`
          );
          const cellInactive = document.getElementById(
            `score-${1 - joueurActuel}-${i}`
          );
          cellInactive.classList.remove("jouable", "max-score", "zero-score");

          if (scores[joueurActuel][i] === null) {
            let s = calculerScore(i);

            // Cas des nombres 1 √† 6 : proposer si au moins un d√© correspond
            if (i <= 5 && s > 0) {
              cellActive.classList.add("jouable");
              cellActive.classList.remove("max-score", "zero-score");
            }
            // Cas combinaisons : mettre en surbrillance selon maxScore
            else if (i > 5 && s === maxScore && s > 0) {
              cellActive.classList.add("max-score");
              cellActive.classList.remove("zero-score", "jouable");
            }
            // Si aucun point et derniers lancers : proposer 0
            else if (s === 0 && lancersRestants === 0) {
              cellActive.classList.add("zero-score");
              cellActive.classList.remove("max-score", "jouable");
            } else {
              cellActive.classList.remove("max-score", "zero-score", "jouable");
            }
          }
        });
      }

      function choisirScore(joueur, catIndex) {
        if (joueur !== joueurActuel) return;
        if (scores[joueur][catIndex] !== null) {
          alert("Case d√©j√† remplie !");
          return;
        }
        scores[joueur][catIndex] = calculerScore(catIndex);
        document.getElementById(`score-${joueur}-${catIndex}`).textContent =
          scores[joueur][catIndex];
        updateTotals();

        joueurActuel = 1 - joueurActuel;
        lancersRestants = 3;
        gardes = [false, false, false, false, false];
        des = [0, 0, 0, 0, 0];
        majAffichage();

        if (
          scores[0].every((s) => s !== null) &&
          scores[1].every((s) => s !== null)
        )
          finDePartie();
      }

      function finDePartie() {
        let total1 =
          scores[0].reduce((a, b) => a + (b || 0), 0) + calculerBonus(0);
        let total2 =
          scores[1].reduce((a, b) => a + (b || 0), 0) + calculerBonus(1);

        const popup = document.getElementById("popup-victoire");
        const message = document.getElementById("popup-message");

        if (total1 > total2) {
          message.textContent = `üèÜ Joueur 1 gagne avec ${total1} pts !`;
        } else if (total2 > total1) {
          message.textContent = `üèÜ Joueur 2 gagne avec ${total2} pts !`;
        } else {
          message.textContent = "√âgalit√© parfaite !";
        }

        popup.classList.remove("hidden");
        relancerBtn.disabled = true;

        // Fermer la popup
        document.getElementById("popup-close").onclick = () => {
          popup.classList.add("hidden");
        };
      }

      function resetGame() {
        // R√©initialiser toutes les variables
        des = [0, 0, 0, 0, 0];
        gardes = [false, false, false, false, false];
        lancersRestants = 3;
        joueurActuel = 0;
        scores = [
          Array(categories.length).fill(null),
          Array(categories.length).fill(null),
        ];
        relancerBtn.disabled = false;
        majAffichage();
        initScoreboard();

        // Masquer la popup
        document.getElementById("popup-victoire").classList.add("hidden");
      }

      // √âv√©nement sur le bouton Recommencer
      document.getElementById("popup-restart").onclick = resetGame;

      relancerBtn.addEventListener("click", lancerDes);
      initScoreboard();
      majAffichage();

      // Afficher la popup r√®gles
      document.getElementById("btn-regles").onclick = () => {
        document.getElementById("popup-regles").classList.remove("hidden");
      };

      // Fermer la popup r√®gles
      document.getElementById("popup-regles-close").onclick = () => {
        document.getElementById("popup-regles").classList.add("hidden");
      };
    </script>
  </body>
</html>
